<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Directory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        #total-count {
            font-size: 1.1rem;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            align-items: start;
        }

        .form-card, .contacts-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .form-card h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5rem;
        }

        #contact-form input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        #contact-form input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #contact-form button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        #contact-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .search-section {
            margin-bottom: 25px;
        }

        .search-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-grid input {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-grid input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        #sort-toggle {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #sort-toggle:hover {
            background: #667eea;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        td[colspan="4"] {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
        }

        td button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 5px;
        }

        td button:first-child {
            background: #3498db;
            color: white;
        }

        td button:first-child:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        td button:last-child {
            background: #e74c3c;
            color: white;
        }

        td button:last-child:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: white;
            padding: 35px;
            width: 400px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .modal-content input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .modal-content input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-content p {
            color: #555;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
        }

        .modal-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #save-edit, #confirm-delete {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        #save-edit:hover, #confirm-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #cancel-edit, #cancel-delete {
            background: #95a5a6;
            color: white;
        }

        #cancel-edit:hover, #cancel-delete:hover {
            background: #7f8c8d;
        }

        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 2px solid rgba(102, 126, 234, 0.3);
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }

        footer p:first-child {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        #footer-message {
            font-style: italic;
            color: #888;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìá Contact Directory</h1>
            <p id="total-count">Total contacts: 0</p>
        </div>

        <div class="main-content">
            <div class="form-card">
                <h2>‚ûï Add New Contact</h2>
                <form id="contact-form">
                    <input type="text" id="name" name="name" placeholder="Name *" required>
                    <input type="text" id="phone" name="phone" placeholder="Phone *" required>
                    <input type="email" id="email" name="email" placeholder="Email (optional)">
                    <button type="submit">Add Contact</button>
                </form>
            </div>

            <div class="contacts-card">
                <div class="search-section">
                    <h3>üîç Search & Filter</h3>
                    <div class="search-grid">
                        <input type="text" id="search" placeholder="Search by name...">
                        <input type="text" id="searchNumber" placeholder="Search by phone...">
                        <input type="email" id="searchMail" placeholder="Search by email...">
                    </div>
                    <button id="sort-toggle">Sort: Oldest</button>
                </div>

                <table id="contact-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="contact-body">
                        <tr><td colspan="4">No contacts yet</td></tr>
                        <tr><td colspan="4">No contacts yet</td></tr>
                        <tr><td colspan="4">No contacts yet</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal hidden">
        <div class="modal-content">
            <h3>‚úèÔ∏è Edit Contact</h3>
            <input type="text" id="edit-name" placeholder="Name">
            <input type="text" id="edit-phone" placeholder="Phone">
            <input type="email" id="edit-email" placeholder="Email">
            <div class="modal-actions">
                <button id="save-edit">Save</button>
                <button id="cancel-edit">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-content">
            <h3>üóëÔ∏è Delete Contact</h3>
            <p>Are you sure you want to delete this contact?</p>
            <div class="modal-actions">
                <button id="confirm-delete">Delete</button>
                <button id="cancel-delete">Cancel</button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Contact Directory App (AppDev Finals Project)</p>
        <p id="footer-message"></p>
    </footer>

    <script>
        const API_URL = "http://localhost:5000/api/contacts";

        const form = document.getElementById("contact-form");
        const tableBody = document.getElementById("contact-body");

        const nameInput = document.getElementById("name");
        const phoneInput = document.getElementById("phone");
        const emailInput = document.getElementById("email");

        const searchInput = document.getElementById("search");
        const searchMailInput = document.getElementById("searchMail");
        const searchNumberInput = document.getElementById("searchNumber");

        const sortBtn = document.getElementById("sort-toggle");

        let allContacts = [];
        let sortMode = 0;
        // 0 = original
        // 1 = A-Z
        // 2 = Z-A
        // 3 = recent

        const editModal = document.getElementById("edit-modal");
        const editName = document.getElementById("edit-name");
        const editPhone = document.getElementById("edit-phone");
        const editEmail = document.getElementById("edit-email");
        const saveEditBtn = document.getElementById("save-edit");
        const cancelEditBtn = document.getElementById("cancel-edit");

        let editingId = null;

        const deleteModal = document.getElementById("delete-modal");
        const confirmDeleteBtn = document.getElementById("confirm-delete");
        const cancelDeleteBtn = document.getElementById("cancel-delete");

        let deletingId = null;

        // ADD CONTACT
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const contact = {
                name: nameInput.value,
                phone: phoneInput.value,
                email: emailInput.value
            };

            await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(contact)
            });

            form.reset();
            loadContacts();
            updateFooterMessage();
        });

        // LOAD CONTACTS
        async function loadContacts() {
            const res = await fetch(API_URL);
            allContacts = await res.json();

            allContacts.forEach((c, i) => c._originalIndex = i);

            applyFiltersAndSort();
        }

        // FILTER + SORT
        function applyFiltersAndSort() {
            let data = [...allContacts];

            const nameQuery = searchInput.value.toLowerCase();
            const mailQuery = searchMailInput.value.toLowerCase();
            const phoneQuery = searchNumberInput.value.toLowerCase();

            if (nameQuery) {
                data = data.filter(c => c.name.toLowerCase().includes(nameQuery));
            }

            if (mailQuery) {
                data = data.filter(c =>
                    (c.email || "").toLowerCase().includes(mailQuery)
                );
            }

            if (phoneQuery) {
                data = data.filter(c => c.phone.includes(phoneQuery));
            }

            if (sortMode === 1) {
                data.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortMode === 2) {
                data.sort((a, b) => b.name.localeCompare(a.name));
            } else if (sortMode === 3) {
                data.sort((a, b) => b._originalIndex - a._originalIndex);
            } else {
                data.sort((a, b) => a._originalIndex - b._originalIndex);
            }

            renderTable(data);
        }

        // RENDER TABLE
        function renderTable(data) {
            tableBody.innerHTML = "";

            document.getElementById("total-count").textContent =
                `Total contacts: ${data.length}`;

            if (data.length === 0) {
                for (let i = 0; i < 3; i++) {
                    const row = document.createElement("tr");
                    row.innerHTML = `<td colspan="4">No contacts yet</td>`;
                    tableBody.appendChild(row);
                }
                return;
            }

            data.forEach(c => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${c.name}</td>
                    <td>${c.phone}</td>
                    <td>${c.email || "-"}</td>
                    <td>
                        <button onclick="editContact('${c._id}', '${c.name}', '${c.phone}', '${c.email || ""}')">Edit</button>
                        <button onclick="deleteContact('${c._id}')">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // SEARCH EVENTS
        searchInput.addEventListener("input", applyFiltersAndSort);
        searchMailInput.addEventListener("input", applyFiltersAndSort);
        searchNumberInput.addEventListener("input", applyFiltersAndSort);

        // SORT TOGGLE
        sortBtn.addEventListener("click", () => {
            sortMode = (sortMode + 1) % 4;

            if (sortMode === 1) sortBtn.textContent = "Sort: A to Z";
            else if (sortMode === 2) sortBtn.textContent = "Sort: Z to A";
            else if (sortMode === 3) sortBtn.textContent = "Sort: Recent";
            else sortBtn.textContent = "Sort: Oldest";

            applyFiltersAndSort();
        });

        // DELETE
        function deleteContact(id) {
            deletingId = id;
            deleteModal.classList.remove("hidden");
        }

        confirmDeleteBtn.addEventListener("click", async () => {
            await fetch(`${API_URL}/${deletingId}`, { method: "DELETE" });
            deleteModal.classList.add("hidden");
            deletingId = null;
            loadContacts();
            updateFooterMessage();
        });

        cancelDeleteBtn.addEventListener("click", () => {
            deleteModal.classList.add("hidden");
            deletingId = null;
        });

        // EDIT
        function editContact(id, name, phone, email) {
            editingId = id;
            editName.value = name;
            editPhone.value = phone;
            editEmail.value = email;
            editModal.classList.remove("hidden");
        }

        saveEditBtn.addEventListener("click", async () => {
            await fetch(`${API_URL}/${editingId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: editName.value,
                    phone: editPhone.value,
                    email: editEmail.value
                })
            });

            editModal.classList.add("hidden");
            editingId = null;
            loadContacts();
            updateFooterMessage();
        });

        cancelEditBtn.addEventListener("click", () => {
            editModal.classList.add("hidden");
            editingId = null;
        });

        // FOOTER MESSAGES
        const footerMessages = [
            "i'm suffering - Cloud 2025",
            "why is this working",
            "Fun Fact: Cloud died 3 times when running \"npm init --y\"",
            "deadline approaching fast, and i am one lazy mf - Cloud",
            "This footer is brought to you by Raid Shadow Leg-",
            "Did you know? Cloud made this footer feature for no reason at all.",
            "If you're reading this, congrats! You've found the secret footer message.",
            "Cloud was here. Now you are too.",
            "This footer message changes randomly. Just like Cloud's motivation",
            "...",
            "Winter (from The Four Seasons) by Antonio Vivaldi",
            "Experience by Ludovico Einaudi is majestic - Cloud",
            "asdfghjklqwertyuiopzxcvbnm - Cloud",
            "cram"
        ];

        function updateFooterMessage() {
            const footerEl = document.getElementById("footer-message");
            const randomIndex = Math.floor(Math.random() * footerMessages.length);
            footerEl.textContent = footerMessages[randomIndex];
        }

        // Initialize
        document.addEventListener("DOMContentLoaded", () => {
            updateFooterMessage();
            loadContacts();
        });
    </script>
</body>
</html>